---
- name: Configure / Update yum packages
  yum:
    name: '*'
    state: latest
    update_cache: yes

- name: install docker
  yum:
    name: docker
    state: latest

- name: service docker
  service:
    name: docker
    state: started
    
- name: install docker SDK
  command: "pip3 install docker"

- name: OpenVPN config
  docker_container:
    name: myownvpn
    image: kylemanna/openvpn
    state: started
    command: ovpn_genconfig
    recreate: yes
    user: udp://"{{ public_ip }}":"{{ ovpn_port }}"
    auto_remove: true
    ports: 
      - "{{ ovpn_port }}:1194"
    volumes:
      - /home/ec2-user/vpn-data:/etc/openvpn

    detach: yes